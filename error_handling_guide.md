# é”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆæŒ‡å—

> GitHub Stars Manager é”™è¯¯å¤„ç†ä¸ç”¨æˆ·åé¦ˆæœ€ä½³å®è·µæŒ‡å—  
> ç‰ˆæœ¬ï¼š1.0  
> æœ€åæ›´æ–°ï¼š2025-10-31

## ç›®å½•

1. [é”™è¯¯å¤„ç†ä½“ç³»](#é”™è¯¯å¤„ç†ä½“ç³»)
2. [å‰ç«¯é”™è¯¯å¤„ç†](#å‰ç«¯é”™è¯¯å¤„ç†)
3. [åç«¯é”™è¯¯å¤„ç†](#åç«¯é”™è¯¯å¤„ç†)
4. [ç”¨æˆ·åé¦ˆæœºåˆ¶](#ç”¨æˆ·åé¦ˆæœºåˆ¶)
5. [é”™è¯¯æ—¥å¿—è®°å½•](#é”™è¯¯æ—¥å¿—è®°å½•)
6. [é”™è¯¯ç›‘æ§ä¸ŠæŠ¥](#é”™è¯¯ç›‘æ§ä¸ŠæŠ¥)
7. [å®¹é”™è®¾è®¡](#å®¹é”™è®¾è®¡)
8. [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)

---

## é”™è¯¯å¤„ç†ä½“ç³»

### é”™è¯¯åˆ†ç±»

æˆ‘ä»¬å°†é”™è¯¯åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªå±‚çº§ï¼š

#### 1. è‡´å‘½é”™è¯¯ï¼ˆCriticalï¼‰
- **å½±å“èŒƒå›´**ï¼šå¯¼è‡´åº”ç”¨å´©æºƒæˆ–æ ¸å¿ƒåŠŸèƒ½æ— æ³•ä½¿ç”¨
- **ç¤ºä¾‹**ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥ã€å†…å­˜æº¢å‡º
- **å¤„ç†ç­–ç•¥**ï¼šç«‹å³è®°å½•ã€é€šçŸ¥ç®¡ç†å‘˜ã€æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯é¡µé¢
- **ç”¨æˆ·ä½“éªŒ**ï¼šæä¾›æ˜ç¡®çš„é”™è¯¯ä¿¡æ¯å’Œè§£å†³å»ºè®®

#### 2. ä¸¥é‡é”™è¯¯ï¼ˆErrorï¼‰
- **å½±å“èŒƒå›´**ï¼šåŠŸèƒ½ä¸å¯ç”¨ï¼Œä½†ä¸å½±å“å…¶ä»–åŠŸèƒ½
- **ç¤ºä¾‹**ï¼šAPIè°ƒç”¨å¤±è´¥ã€æ–‡ä»¶è¯»å†™é”™è¯¯
- **å¤„ç†ç­–ç•¥**ï¼šè®°å½•æ—¥å¿—ã€æ˜¾ç¤ºé”™è¯¯æç¤ºã€æä¾›é‡è¯•é€‰é¡¹
- **ç”¨æˆ·ä½“éªŒ**ï¼šToasté€šçŸ¥ + é‡è¯•æŒ‰é’®

#### 3. è­¦å‘Šï¼ˆWarningï¼‰
- **å½±å“èŒƒå›´**ï¼šéƒ¨åˆ†åŠŸèƒ½å—é™æˆ–æ€§èƒ½ä¸‹é™
- **ç¤ºä¾‹**ï¼šGitHub APIé€Ÿç‡é™åˆ¶ã€ç½‘ç»œå»¶è¿Ÿ
- **å¤„ç†ç­–ç•¥**ï¼šè®°å½•æ—¥å¿—ã€æ˜¾ç¤ºè­¦å‘Šæç¤º
- **ç”¨æˆ·ä½“éªŒ**ï¼šæ¸©å’Œçš„æç¤ºä¿¡æ¯

#### 4. ä¿¡æ¯ï¼ˆInfoï¼‰
- **å½±å“èŒƒå›´**ï¼šä¸å½±å“åŠŸèƒ½ï¼Œä»…ä¾›å‚è€ƒ
- **ç¤ºä¾‹**ï¼šåŒæ­¥å®Œæˆã€æ“ä½œæˆåŠŸ
- **å¤„ç†ç­–ç•¥**ï¼šç®€å•è®°å½•ã€å¯é€‰çš„æç¤º
- **ç”¨æˆ·ä½“éªŒ**ï¼šç®€çŸ­çš„æˆåŠŸæç¤º

### é”™è¯¯ç è§„èŒƒ

ä½¿ç”¨ç»Ÿä¸€çš„é”™è¯¯ç ä½“ç³»ï¼š

```
[ç³»ç»Ÿæ¨¡å—][é”™è¯¯ç±»å‹][å…·ä½“é”™è¯¯]
```

**ç³»ç»Ÿæ¨¡å—ä»£ç **ï¼š
- `01` - è®¤è¯æ¨¡å—ï¼ˆAuthï¼‰
- `02` - ä»“åº“ç®¡ç†ï¼ˆRepositoryï¼‰
- `03` - Releaseç®¡ç†
- `04` - AIæœåŠ¡
- `05` - å¤‡ä»½æœåŠ¡
- `06` - åŒæ­¥æœåŠ¡
- `07` - æ•°æ®åº“
- `08` - ç½‘ç»œè¯·æ±‚
- `09` - æ–‡ä»¶ç³»ç»Ÿ

**é”™è¯¯ç±»å‹ä»£ç **ï¼š
- `1` - éªŒè¯é”™è¯¯ï¼ˆValidationï¼‰
- `2` - æƒé™é”™è¯¯ï¼ˆPermissionï¼‰
- `3` - èµ„æºä¸å­˜åœ¨ï¼ˆNotFoundï¼‰
- `4` - ä¸šåŠ¡é€»è¾‘é”™è¯¯ï¼ˆBusinessï¼‰
- `5` - ç³»ç»Ÿé”™è¯¯ï¼ˆSystemï¼‰

**ç¤ºä¾‹**ï¼š
- `011001` - è®¤è¯æ¨¡å—-éªŒè¯é”™è¯¯-Tokenæ— æ•ˆ
- `021003` - ä»“åº“ç®¡ç†-èµ„æºä¸å­˜åœ¨-ä»“åº“ä¸å­˜åœ¨
- `081005` - ç½‘ç»œè¯·æ±‚-ç³»ç»Ÿé”™è¯¯-è¯·æ±‚è¶…æ—¶

---

## å‰ç«¯é”™è¯¯å¤„ç†

### 1. React é”™è¯¯è¾¹ç•Œï¼ˆError Boundaryï¼‰

åœ¨åº”ç”¨é¡¶å±‚ä½¿ç”¨é”™è¯¯è¾¹ç•Œæ•è·æœªå¤„ç†çš„Reactç»„ä»¶é”™è¯¯ï¼š

```typescript
// components/ErrorBoundary.tsx
import React, { Component, ReactNode } from 'react';
import { AlertTriangle } from 'lucide-react';

interface Props {
  children: ReactNode;
  fallback?: ReactNode;
}

interface State {
  hasError: boolean;
  error: Error | null;
  errorInfo: React.ErrorInfo | null;
}

export class ErrorBoundary extends Component<Props, State> {
  constructor(props: Props) {
    super(props);
    this.state = {
      hasError: false,
      error: null,
      errorInfo: null,
    };
  }

  static getDerivedStateFromError(error: Error): Partial<State> {
    return { hasError: true, error };
  }

  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {
    // è®°å½•é”™è¯¯åˆ°æ—¥å¿—æœåŠ¡
    console.error('React Error Boundary caught:', error, errorInfo);
    
    // å‘é€åˆ°é”™è¯¯ç›‘æ§æœåŠ¡
    this.reportError(error, errorInfo);
    
    this.setState({
      error,
      errorInfo,
    });
  }

  reportError(error: Error, errorInfo: React.ErrorInfo) {
    // TODO: é›†æˆé”™è¯¯ç›‘æ§æœåŠ¡ï¼ˆå¦‚ Sentryï¼‰
    if (window.errorReporter) {
      window.errorReporter.captureException(error, {
        contexts: {
          react: {
            componentStack: errorInfo.componentStack,
          },
        },
      });
    }
  }

  handleReload = () => {
    window.location.reload();
  };

  handleReset = () => {
    this.setState({
      hasError: false,
      error: null,
      errorInfo: null,
    });
  };

  render() {
    if (this.state.hasError) {
      if (this.props.fallback) {
        return this.props.fallback;
      }

      return (
        <div className="min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 p-4">
          <div className="max-w-md w-full bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
            <div className="flex items-center gap-3 mb-4">
              <AlertTriangle className="w-8 h-8 text-red-500" />
              <h1 className="text-xl font-bold text-gray-900 dark:text-white">
                åº”ç”¨å‡ºé”™äº†
              </h1>
            </div>
            
            <p className="text-gray-600 dark:text-gray-300 mb-4">
              å¾ˆæŠ±æ­‰ï¼Œåº”ç”¨é‡åˆ°äº†ä¸€ä¸ªæ„å¤–é”™è¯¯ã€‚æ‚¨å¯ä»¥å°è¯•åˆ·æ–°é¡µé¢æˆ–è”ç³»æŠ€æœ¯æ”¯æŒã€‚
            </p>
            
            {process.env.NODE_ENV === 'development' && this.state.error && (
              <details className="mb-4 p-3 bg-gray-100 dark:bg-gray-700 rounded">
                <summary className="cursor-pointer font-medium text-sm text-gray-700 dark:text-gray-300">
                  é”™è¯¯è¯¦æƒ…ï¼ˆå¼€å‘æ¨¡å¼ï¼‰
                </summary>
                <pre className="mt-2 text-xs text-red-600 dark:text-red-400 overflow-auto">
                  {this.state.error.toString()}
                  {this.state.errorInfo?.componentStack}
                </pre>
              </details>
            )}
            
            <div className="flex gap-3">
              <button
                onClick={this.handleReload}
                className="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition"
              >
                åˆ·æ–°é¡µé¢
              </button>
              <button
                onClick={this.handleReset}
                className="flex-1 px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-white rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition"
              >
                é‡ç½®çŠ¶æ€
              </button>
            </div>
          </div>
        </div>
      );
    }

    return this.props.children;
  }
}
```

### 2. API é”™è¯¯å¤„ç†

åˆ›å»ºç»Ÿä¸€çš„ API é”™è¯¯å¤„ç†å·¥å…·ï¼š

```typescript
// services/errorHandler.ts
import { toast } from '@/hooks/use-toast';
import { AxiosError } from 'axios';

export interface ApiError {
  code: string;
  message: string;
  details?: any;
  timestamp: string;
}

export class ErrorHandler {
  /**
   * å¤„ç† API é”™è¯¯
   */
  static handleApiError(error: unknown): ApiError {
    if (error instanceof AxiosError) {
      const response = error.response;
      
      if (!response) {
        // ç½‘ç»œé”™è¯¯
        return {
          code: '081001',
          message: 'ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ‚¨çš„ç½‘ç»œè®¾ç½®',
          timestamp: new Date().toISOString(),
        };
      }

      // æ ¹æ®çŠ¶æ€ç å¤„ç†
      switch (response.status) {
        case 400:
          return {
            code: '011001',
            message: response.data?.message || 'è¯·æ±‚å‚æ•°é”™è¯¯',
            details: response.data?.details,
            timestamp: new Date().toISOString(),
          };
        
        case 401:
          // è®¤è¯å¤±è´¥ï¼Œè·³è½¬ç™»å½•
          localStorage.removeItem('github_token');
          window.location.href = '/login';
          return {
            code: '011002',
            message: 'è®¤è¯å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•',
            timestamp: new Date().toISOString(),
          };
        
        case 403:
          return {
            code: '012001',
            message: 'æ‚¨æ²¡æœ‰æƒé™æ‰§è¡Œæ­¤æ“ä½œ',
            timestamp: new Date().toISOString(),
          };
        
        case 404:
          return {
            code: '021003',
            message: response.data?.message || 'è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨',
            timestamp: new Date().toISOString(),
          };
        
        case 429:
          return {
            code: '081002',
            message: 'API è°ƒç”¨é¢‘ç‡è¿‡é«˜ï¼Œè¯·ç¨åå†è¯•',
            details: response.headers['x-ratelimit-reset'],
            timestamp: new Date().toISOString(),
          };
        
        case 500:
        case 502:
        case 503:
        case 504:
          return {
            code: '081005',
            message: 'æœåŠ¡å™¨é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•',
            timestamp: new Date().toISOString(),
          };
        
        default:
          return {
            code: '081000',
            message: response.data?.message || 'æœªçŸ¥é”™è¯¯',
            details: response.data,
            timestamp: new Date().toISOString(),
          };
      }
    }

    // å…¶ä»–ç±»å‹çš„é”™è¯¯
    if (error instanceof Error) {
      return {
        code: '091000',
        message: error.message,
        timestamp: new Date().toISOString(),
      };
    }

    return {
      code: '099999',
      message: 'æœªçŸ¥é”™è¯¯',
      details: error,
      timestamp: new Date().toISOString(),
    };
  }

  /**
   * æ˜¾ç¤ºé”™è¯¯æç¤º
   */
  static showError(error: unknown, title = 'æ“ä½œå¤±è´¥') {
    const apiError = this.handleApiError(error);
    
    toast({
      title,
      description: apiError.message,
      variant: 'destructive',
    });

    // è®°å½•åˆ°æ—¥å¿—
    this.logError(apiError);
  }

  /**
   * è®°å½•é”™è¯¯æ—¥å¿—
   */
  static logError(error: ApiError) {
    console.error('[Error Log]', {
      ...error,
      userAgent: navigator.userAgent,
      url: window.location.href,
    });

    // TODO: å‘é€åˆ°æ—¥å¿—æœåŠ¡å™¨
  }

  /**
   * åŒ…è£…å¼‚æ­¥æ“ä½œï¼Œè‡ªåŠ¨å¤„ç†é”™è¯¯
   */
  static async tryAsync<T>(
    operation: () => Promise<T>,
    options?: {
      errorMessage?: string;
      showError?: boolean;
      onError?: (error: ApiError) => void;
    }
  ): Promise<T | null> {
    try {
      return await operation();
    } catch (error) {
      const apiError = this.handleApiError(error);
      
      if (options?.showError !== false) {
        this.showError(error, options?.errorMessage);
      }

      if (options?.onError) {
        options.onError(apiError);
      }

      return null;
    }
  }
}

// GitHub ç‰¹å®šé”™è¯¯å¤„ç†
export class GitHubErrorHandler {
  static handleGitHubError(error: any) {
    if (error.message?.includes('rate limit')) {
      toast({
        title: 'API é€Ÿç‡é™åˆ¶',
        description: 'GitHub API è°ƒç”¨æ¬¡æ•°å·²è¾¾ä¸Šé™ï¼Œè¯·ç¨åå†è¯•',
        variant: 'destructive',
      });
      return;
    }

    if (error.message?.includes('Not Found')) {
      toast({
        title: 'ä»“åº“ä¸å­˜åœ¨',
        description: 'è¯·æ±‚çš„ä»“åº“ä¸å­˜åœ¨æˆ–å·²è¢«åˆ é™¤',
        variant: 'destructive',
      });
      return;
    }

    if (error.message?.includes('Bad credentials')) {
      toast({
        title: 'Token æ— æ•ˆ',
        description: 'æ‚¨çš„ GitHub Token æ— æ•ˆæˆ–å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•',
        variant: 'destructive',
      });
      localStorage.removeItem('github_token');
      window.location.href = '/login';
      return;
    }

    // é»˜è®¤é”™è¯¯å¤„ç†
    ErrorHandler.showError(error);
  }
}
```

### 3. è¡¨å•éªŒè¯é”™è¯¯

```typescript
// utils/validation.ts
import { z } from 'zod';

export class ValidationError extends Error {
  constructor(
    message: string,
    public field?: string,
    public code = 'VALIDATION_ERROR'
  ) {
    super(message);
    this.name = 'ValidationError';
  }
}

/**
 * éªŒè¯ GitHub Token æ ¼å¼
 */
export function validateGitHubToken(token: string): boolean {
  if (!token || token.trim().length === 0) {
    throw new ValidationError('Token ä¸èƒ½ä¸ºç©º', 'token');
  }

  // GitHub Personal Access Token æ ¼å¼éªŒè¯
  if (!/^(ghp_|github_pat_)[a-zA-Z0-9]{36,}$/.test(token)) {
    throw new ValidationError(
      'Token æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·æ£€æŸ¥æ‚¨çš„ GitHub Personal Access Token',
      'token'
    );
  }

  return true;
}

/**
 * æ˜¾ç¤ºè¡¨å•éªŒè¯é”™è¯¯
 */
export function showValidationError(error: z.ZodError) {
  const firstError = error.errors[0];
  toast({
    title: 'è¡¨å•éªŒè¯å¤±è´¥',
    description: firstError.message,
    variant: 'destructive',
  });
}
```

### 4. å¼‚æ­¥æ“ä½œåŒ…è£…

```typescript
// hooks/useAsyncOperation.ts
import { useState } from 'react';
import { ErrorHandler } from '@/services/errorHandler';

export function useAsyncOperation<T>() {
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const execute = async (
    operation: () => Promise<T>,
    options?: {
      successMessage?: string;
      errorMessage?: string;
      onSuccess?: (result: T) => void;
      onError?: () => void;
    }
  ) => {
    setLoading(true);
    setError(null);

    try {
      const result = await operation();
      
      if (options?.successMessage) {
        toast({
          title: 'æ“ä½œæˆåŠŸ',
          description: options.successMessage,
        });
      }

      options?.onSuccess?.(result);
      return result;
    } catch (err) {
      const errorMessage = options?.errorMessage || 'æ“ä½œå¤±è´¥';
      ErrorHandler.showError(err, errorMessage);
      setError(errorMessage);
      options?.onError?.();
      return null;
    } finally {
      setLoading(false);
    }
  };

  return { loading, error, execute };
}
```

---

## åç«¯é”™è¯¯å¤„ç†

### 1. Python å¼‚å¸¸ä½“ç³»

```python
# services/exceptions.py

class AppException(Exception):
    """åº”ç”¨åŸºç¡€å¼‚å¸¸ç±»"""
    
    def __init__(
        self,
        message: str,
        code: str = "UNKNOWN_ERROR",
        details: dict = None,
        http_status: int = 500
    ):
        super().__init__(message)
        self.message = message
        self.code = code
        self.details = details or {}
        self.http_status = http_status
        self.timestamp = datetime.now().isoformat()

    def to_dict(self) -> dict:
        """è½¬æ¢ä¸ºå­—å…¸æ ¼å¼"""
        return {
            "code": self.code,
            "message": self.message,
            "details": self.details,
            "timestamp": self.timestamp
        }


class ValidationError(AppException):
    """éªŒè¯é”™è¯¯"""
    
    def __init__(self, message: str, field: str = None, **kwargs):
        super().__init__(
            message=message,
            code="VALIDATION_ERROR",
            details={"field": field} if field else {},
            http_status=400,
            **kwargs
        )


class AuthenticationError(AppException):
    """è®¤è¯é”™è¯¯"""
    
    def __init__(self, message: str = "è®¤è¯å¤±è´¥", **kwargs):
        super().__init__(
            message=message,
            code="AUTH_ERROR",
            http_status=401,
            **kwargs
        )


class PermissionError(AppException):
    """æƒé™é”™è¯¯"""
    
    def __init__(self, message: str = "æƒé™ä¸è¶³", **kwargs):
        super().__init__(
            message=message,
            code="PERMISSION_ERROR",
            http_status=403,
            **kwargs
        )


class NotFoundError(AppException):
    """èµ„æºä¸å­˜åœ¨é”™è¯¯"""
    
    def __init__(self, resource: str = "èµ„æº", **kwargs):
        super().__init__(
            message=f"{resource}ä¸å­˜åœ¨",
            code="NOT_FOUND",
            http_status=404,
            **kwargs
        )


class RateLimitError(AppException):
    """é€Ÿç‡é™åˆ¶é”™è¯¯"""
    
    def __init__(self, retry_after: int = None, **kwargs):
        super().__init__(
            message="è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•",
            code="RATE_LIMIT",
            details={"retry_after": retry_after} if retry_after else {},
            http_status=429,
            **kwargs
        )


class ExternalServiceError(AppException):
    """å¤–éƒ¨æœåŠ¡é”™è¯¯"""
    
    def __init__(self, service_name: str, original_error: str = None, **kwargs):
        super().__init__(
            message=f"{service_name}æœåŠ¡è°ƒç”¨å¤±è´¥",
            code="EXTERNAL_SERVICE_ERROR",
            details={"service": service_name, "original_error": original_error},
            http_status=502,
            **kwargs
        )
```

### 2. æ•°æ®åº“å¼‚å¸¸å¤„ç†

```python
# services/db_error_handler.py
import sqlite3
from typing import Any, Callable, TypeVar

T = TypeVar('T')

class DatabaseError(AppException):
    """æ•°æ®åº“é”™è¯¯"""
    
    def __init__(self, message: str, query: str = None, **kwargs):
        super().__init__(
            message=message,
            code="DATABASE_ERROR",
            details={"query": query} if query else {},
            http_status=500,
            **kwargs
        )


def handle_db_errors(func: Callable[..., T]) -> Callable[..., T]:
    """æ•°æ®åº“æ“ä½œè£…é¥°å™¨"""
    
    def wrapper(*args, **kwargs) -> T:
        try:
            return func(*args, **kwargs)
        except sqlite3.IntegrityError as e:
            if "UNIQUE constraint failed" in str(e):
                raise ValidationError("æ•°æ®å·²å­˜åœ¨ï¼Œè¯·å‹¿é‡å¤æ·»åŠ ")
            elif "FOREIGN KEY constraint failed" in str(e):
                raise ValidationError("å…³è”çš„æ•°æ®ä¸å­˜åœ¨")
            else:
                raise DatabaseError(f"æ•°æ®å®Œæ•´æ€§é”™è¯¯: {str(e)}")
        except sqlite3.OperationalError as e:
            raise DatabaseError(f"æ•°æ®åº“æ“ä½œé”™è¯¯: {str(e)}")
        except sqlite3.DatabaseError as e:
            raise DatabaseError(f"æ•°æ®åº“é”™è¯¯: {str(e)}")
        except Exception as e:
            logger.error(f"Unexpected database error: {e}", exc_info=True)
            raise DatabaseError("æ•°æ®åº“æ“ä½œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•")
    
    return wrapper
```

---

## ç”¨æˆ·åé¦ˆæœºåˆ¶

### 1. Toast é€šçŸ¥

ä½¿ç”¨ shadcn/ui çš„ Toast ç»„ä»¶æä¾›å³æ—¶åé¦ˆï¼š

```typescript
// æˆåŠŸæç¤º
toast({
  title: "æ“ä½œæˆåŠŸ",
  description: "ä»“åº“å·²æˆåŠŸæ·»åŠ åˆ°æ”¶è—",
});

// é”™è¯¯æç¤º
toast({
  title: "æ“ä½œå¤±è´¥",
  description: "æ— æ³•è¿æ¥åˆ° GitHub API",
  variant: "destructive",
});

// è­¦å‘Šæç¤º
toast({
  title: "æ³¨æ„",
  description: "æ‚¨çš„ API è°ƒç”¨æ¬¡æ•°å³å°†è¾¾åˆ°é™åˆ¶",
  variant: "warning",
});

// ä¿¡æ¯æç¤º
toast({
  title: "æç¤º",
  description: "åŒæ­¥å°†åœ¨åå°è¿›è¡Œ",
});
```

### 2. Loading çŠ¶æ€

```typescript
// components/LoadingSpinner.tsx
export function LoadingSpinner({ size = 'md' }: { size?: 'sm' | 'md' | 'lg' }) {
  const sizeClasses = {
    sm: 'w-4 h-4',
    md: 'w-8 h-8',
    lg: 'w-12 h-12',
  };

  return (
    <div className="flex items-center justify-center">
      <div
        className={`${sizeClasses[size]} border-4 border-gray-300 border-t-blue-600 rounded-full animate-spin`}
      />
    </div>
  );
}

// æŒ‰é’® Loading çŠ¶æ€
<button disabled={loading} className="...">
  {loading ? (
    <>
      <LoadingSpinner size="sm" />
      <span>å¤„ç†ä¸­...</span>
    </>
  ) : (
    'æäº¤'
  )}
</button>
```

### 3. Progress è¿›åº¦æ¡

```typescript
// components/ProgressBar.tsx
import { Progress } from '@/components/ui/progress';

interface ProgressBarProps {
  current: number;
  total: number;
  label?: string;
}

export function ProgressBar({ current, total, label }: ProgressBarProps) {
  const percentage = Math.round((current / total) * 100);

  return (
    <div className="space-y-2">
      {label && (
        <div className="flex justify-between text-sm text-gray-600">
          <span>{label}</span>
          <span>{current} / {total}</span>
        </div>
      )}
      <Progress value={percentage} />
      <p className="text-xs text-center text-gray-500">{percentage}%</p>
    </div>
  );
}

// ä½¿ç”¨ç¤ºä¾‹ï¼šåŒæ­¥è¿›åº¦
function SyncProgress() {
  const [current, setCurrent] = useState(0);
  const [total, setTotal] = useState(100);

  return (
    <ProgressBar
      current={current}
      total={total}
      label="æ­£åœ¨åŒæ­¥ä»“åº“..."
    />
  );
}
```

### 4. ç¡®è®¤å¯¹è¯æ¡†

```typescript
// components/ConfirmDialog.tsx
import {
  AlertDialog,
  AlertDialogAction,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
} from '@/components/ui/alert-dialog';

interface ConfirmDialogProps {
  open: boolean;
  onOpenChange: (open: boolean) => void;
  title: string;
  description: string;
  onConfirm: () => void;
  confirmText?: string;
  cancelText?: string;
  variant?: 'default' | 'destructive';
}

export function ConfirmDialog({
  open,
  onOpenChange,
  title,
  description,
  onConfirm,
  confirmText = 'ç¡®è®¤',
  cancelText = 'å–æ¶ˆ',
  variant = 'default',
}: ConfirmDialogProps) {
  return (
    <AlertDialog open={open} onOpenChange={onOpenChange}>
      <AlertDialogContent>
        <AlertDialogHeader>
          <AlertDialogTitle>{title}</AlertDialogTitle>
          <AlertDialogDescription>{description}</AlertDialogDescription>
        </AlertDialogHeader>
        <AlertDialogFooter>
          <AlertDialogCancel>{cancelText}</AlertDialogCancel>
          <AlertDialogAction
            onClick={onConfirm}
            className={variant === 'destructive' ? 'bg-red-600 hover:bg-red-700' : ''}
          >
            {confirmText}
          </AlertDialogAction>
        </AlertDialogFooter>
      </AlertDialogContent>
    </AlertDialog>
  );
}

// ä½¿ç”¨ç¤ºä¾‹
function DeleteButton({ repositoryId }: { repositoryId: number }) {
  const [showConfirm, setShowConfirm] = useState(false);

  const handleDelete = async () => {
    await repositoryAPI.delete(repositoryId);
    toast({ title: 'åˆ é™¤æˆåŠŸ' });
    setShowConfirm(false);
  };

  return (
    <>
      <button onClick={() => setShowConfirm(true)}>åˆ é™¤</button>
      <ConfirmDialog
        open={showConfirm}
        onOpenChange={setShowConfirm}
        title="ç¡®è®¤åˆ é™¤"
        description="æ­¤æ“ä½œæ— æ³•æ’¤é”€ï¼Œç¡®å®šè¦åˆ é™¤è¿™ä¸ªä»“åº“å—ï¼Ÿ"
        onConfirm={handleDelete}
        variant="destructive"
      />
    </>
  );
}
```

### 5. æ’¤é”€æ“ä½œ

```typescript
// hooks/useUndoable.ts
import { useState } from 'react';

interface UndoableState<T> {
  present: T;
  past: T[];
  future: T[];
}

export function useUndoable<T>(initialState: T) {
  const [state, setState] = useState<UndoableState<T>>({
    present: initialState,
    past: [],
    future: [],
  });

  const set = (newState: T) => {
    setState({
      present: newState,
      past: [...state.past, state.present],
      future: [],
    });
  };

  const undo = () => {
    if (state.past.length === 0) return;

    const previous = state.past[state.past.length - 1];
    const newPast = state.past.slice(0, state.past.length - 1);

    setState({
      present: previous,
      past: newPast,
      future: [state.present, ...state.future],
    });

    toast({
      title: 'å·²æ’¤é”€',
      description: 'æ“ä½œå·²æ’¤é”€',
    });
  };

  const redo = () => {
    if (state.future.length === 0) return;

    const next = state.future[0];
    const newFuture = state.future.slice(1);

    setState({
      present: next,
      past: [...state.past, state.present],
      future: newFuture,
    });

    toast({
      title: 'å·²é‡åš',
      description: 'æ“ä½œå·²é‡åš',
    });
  };

  return {
    state: state.present,
    set,
    undo,
    redo,
    canUndo: state.past.length > 0,
    canRedo: state.future.length > 0,
  };
}
```

---

## é”™è¯¯æ—¥å¿—è®°å½•

### 1. æ—¥å¿—çº§åˆ«

```python
# services/logger.py
import logging
from datetime import datetime
from pathlib import Path

# æ—¥å¿—çº§åˆ«
LOG_LEVELS = {
    "DEBUG": logging.DEBUG,
    "INFO": logging.INFO,
    "WARNING": logging.WARNING,
    "ERROR": logging.ERROR,
    "CRITICAL": logging.CRITICAL,
}

class AppLogger:
    def __init__(self, name: str, log_dir: str = "logs"):
        self.logger = logging.getLogger(name)
        self.logger.setLevel(logging.DEBUG)
        
        # åˆ›å»ºæ—¥å¿—ç›®å½•
        Path(log_dir).mkdir(exist_ok=True)
        
        # æ–‡ä»¶å¤„ç†å™¨ - æ‰€æœ‰æ—¥å¿—
        file_handler = logging.FileHandler(
            f"{log_dir}/app_{datetime.now().strftime('%Y%m%d')}.log"
        )
        file_handler.setLevel(logging.DEBUG)
        
        # æ–‡ä»¶å¤„ç†å™¨ - ä»…é”™è¯¯
        error_handler = logging.FileHandler(
            f"{log_dir}/error_{datetime.now().strftime('%Y%m%d')}.log"
        )
        error_handler.setLevel(logging.ERROR)
        
        # æ§åˆ¶å°å¤„ç†å™¨
        console_handler = logging.StreamHandler()
        console_handler.setLevel(logging.INFO)
        
        # æ ¼å¼åŒ–
        formatter = logging.Formatter(
            '%(asctime)s - %(name)s - %(levelname)s - %(message)s'
        )
        file_handler.setFormatter(formatter)
        error_handler.setFormatter(formatter)
        console_handler.setFormatter(formatter)
        
        self.logger.addHandler(file_handler)
        self.logger.addHandler(error_handler)
        self.logger.addHandler(console_handler)

    def debug(self, message: str, **kwargs):
        self.logger.debug(message, extra=kwargs)

    def info(self, message: str, **kwargs):
        self.logger.info(message, extra=kwargs)

    def warning(self, message: str, **kwargs):
        self.logger.warning(message, extra=kwargs)

    def error(self, message: str, exc_info=False, **kwargs):
        self.logger.error(message, exc_info=exc_info, extra=kwargs)

    def critical(self, message: str, exc_info=True, **kwargs):
        self.logger.critical(message, exc_info=exc_info, extra=kwargs)

# å…¨å±€æ—¥å¿—å®ä¾‹
logger = AppLogger("GitHubStarsManager")
```

### 2. ç»“æ„åŒ–æ—¥å¿—

```python
# è®°å½•æ“ä½œæ—¥å¿—
logger.info(
    "Repository synced",
    user_id=user.id,
    repository_count=len(repositories),
    duration_ms=elapsed_time
)

# è®°å½•é”™è¯¯æ—¥å¿—
logger.error(
    "GitHub API request failed",
    url=request_url,
    status_code=response.status_code,
    error=str(error),
    exc_info=True
)
```

---

## é”™è¯¯ç›‘æ§ä¸ŠæŠ¥

### 1. å‰ç«¯é”™è¯¯ç›‘æ§

```typescript
// services/errorReporter.ts

interface ErrorReport {
  message: string;
  stack?: string;
  url: string;
  userAgent: string;
  timestamp: string;
  userId?: string;
  additionalData?: any;
}

class ErrorReporter {
  private endpoint = '/api/errors';
  private userId?: string;

  setUserId(userId: string) {
    this.userId = userId;
  }

  async report(error: Error, additionalData?: any) {
    const report: ErrorReport = {
      message: error.message,
      stack: error.stack,
      url: window.location.href,
      userAgent: navigator.userAgent,
      timestamp: new Date().toISOString(),
      userId: this.userId,
      additionalData,
    };

    try {
      await fetch(this.endpoint, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(report),
      });
    } catch (err) {
      console.error('Failed to report error:', err);
    }
  }

  // ç›‘å¬å…¨å±€é”™è¯¯
  init() {
    window.addEventListener('error', (event) => {
      this.report(event.error, {
        type: 'uncaught',
        filename: event.filename,
        lineno: event.lineno,
        colno: event.colno,
      });
    });

    window.addEventListener('unhandledrejection', (event) => {
      this.report(
        new Error(event.reason),
        { type: 'unhandledRejection' }
      );
    });
  }
}

export const errorReporter = new ErrorReporter();

// åœ¨åº”ç”¨å¯åŠ¨æ—¶åˆå§‹åŒ–
errorReporter.init();
```

### 2. æ€§èƒ½ç›‘æ§

```typescript
// services/performanceMonitor.ts

export class PerformanceMonitor {
  static logPageLoad() {
    window.addEventListener('load', () => {
      const perfData = window.performance.timing;
      const pageLoadTime = perfData.loadEventEnd - perfData.navigationStart;
      
      console.log('Page Load Metrics:', {
        pageLoadTime,
        domReady: perfData.domContentLoadedEventEnd - perfData.navigationStart,
        resourcesLoaded: perfData.loadEventEnd - perfData.domContentLoadedEventEnd,
      });
    });
  }

  static measureApiCall(name: string, duration: number) {
    if (duration > 5000) {
      console.warn(`Slow API call detected: ${name} took ${duration}ms`);
    }
  }
}
```

---

## å®¹é”™è®¾è®¡

### 1. é‡è¯•æœºåˆ¶

```typescript
// utils/retry.ts

interface RetryOptions {
  maxAttempts?: number;
  delayMs?: number;
  backoff?: boolean;
  onRetry?: (attempt: number, error: any) => void;
}

export async function withRetry<T>(
  operation: () => Promise<T>,
  options: RetryOptions = {}
): Promise<T> {
  const {
    maxAttempts = 3,
    delayMs = 1000,
    backoff = true,
    onRetry,
  } = options;

  let lastError: any;

  for (let attempt = 1; attempt <= maxAttempts; attempt++) {
    try {
      return await operation();
    } catch (error) {
      lastError = error;

      if (attempt < maxAttempts) {
        const delay = backoff ? delayMs * Math.pow(2, attempt - 1) : delayMs;
        
        onRetry?.(attempt, error);
        
        await new Promise((resolve) => setTimeout(resolve, delay));
      }
    }
  }

  throw lastError;
}

// ä½¿ç”¨ç¤ºä¾‹
const data = await withRetry(
  () => githubAPI.getStarredRepos(token),
  {
    maxAttempts: 3,
    delayMs: 1000,
    backoff: true,
    onRetry: (attempt, error) => {
      console.log(`Retry attempt ${attempt}:`, error);
    },
  }
);
```

### 2. é™çº§ç­–ç•¥

```typescript
// ç¼“å­˜é™çº§
async function getRepositories() {
  try {
    // å°è¯•ä» API è·å–æœ€æ–°æ•°æ®
    const data = await repositoryAPI.getAll();
    localStorage.setItem('repositories_cache', JSON.stringify(data));
    return data;
  } catch (error) {
    // API å¤±è´¥ï¼Œä½¿ç”¨ç¼“å­˜æ•°æ®
    console.warn('API failed, using cached data');
    const cached = localStorage.getItem('repositories_cache');
    if (cached) {
      toast({
        title: 'ç¦»çº¿æ¨¡å¼',
        description: 'æ­£åœ¨æ˜¾ç¤ºç¼“å­˜æ•°æ®',
        variant: 'warning',
      });
      return JSON.parse(cached);
    }
    throw error;
  }
}
```

### 3. ç†”æ–­å™¨æ¨¡å¼

```python
# services/circuit_breaker.py
from datetime import datetime, timedelta
from enum import Enum

class CircuitState(Enum):
    CLOSED = "closed"
    OPEN = "open"
    HALF_OPEN = "half_open"

class CircuitBreaker:
    def __init__(
        self,
        failure_threshold: int = 5,
        timeout_seconds: int = 60,
        success_threshold: int = 2
    ):
        self.failure_threshold = failure_threshold
        self.timeout = timedelta(seconds=timeout_seconds)
        self.success_threshold = success_threshold
        
        self.state = CircuitState.CLOSED
        self.failures = 0
        self.successes = 0
        self.last_failure_time = None

    def call(self, func, *args, **kwargs):
        if self.state == CircuitState.OPEN:
            if datetime.now() - self.last_failure_time > self.timeout:
                self.state = CircuitState.HALF_OPEN
                self.successes = 0
            else:
                raise Exception("Circuit breaker is OPEN")

        try:
            result = func(*args, **kwargs)
            self._on_success()
            return result
        except Exception as e:
            self._on_failure()
            raise e

    def _on_success(self):
        self.failures = 0
        if self.state == CircuitState.HALF_OPEN:
            self.successes += 1
            if self.successes >= self.success_threshold:
                self.state = CircuitState.CLOSED
                self.successes = 0

    def _on_failure(self):
        self.failures += 1
        self.last_failure_time = datetime.now()
        if self.failures >= self.failure_threshold:
            self.state = CircuitState.OPEN
```

---

## æœ€ä½³å®è·µ

### âœ… DOï¼ˆæ¨èåšæ³•ï¼‰

1. **å§‹ç»ˆæä¾›å‹å¥½çš„é”™è¯¯ä¿¡æ¯**
   - âŒ "Error: 500"
   - âœ… "æœåŠ¡å™¨æš‚æ—¶æ— æ³•å“åº”ï¼Œè¯·ç¨åé‡è¯•"

2. **é”™è¯¯è¦åŒ…å«ä¸Šä¸‹æ–‡ä¿¡æ¯**
   ```typescript
   throw new Error(`Failed to sync repository ${repoName}: ${error.message}`);
   ```

3. **å¼‚æ­¥æ“ä½œè¦æœ‰åŠ è½½çŠ¶æ€**
   ```typescript
   const [loading, setLoading] = useState(false);
   // æ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨
   ```

4. **æä¾›æ“ä½œç¡®è®¤ï¼ˆå±é™©æ“ä½œï¼‰**
   - åˆ é™¤ã€æ¸…ç©ºç­‰ä¸å¯é€†æ“ä½œéœ€è¦ç¡®è®¤

5. **é‡è¦æ“ä½œæä¾›æ’¤é”€åŠŸèƒ½**
   - æ‰¹é‡æ“ä½œåæä¾›æ’¤é”€æŒ‰é’®

6. **é”™è¯¯è¦è®°å½•åˆ°æ—¥å¿—**
   ```python
   logger.error(f"Failed to process: {error}", exc_info=True)
   ```

7. **æ•æ„Ÿä¿¡æ¯ä¸è¦æš´éœ²ç»™ç”¨æˆ·**
   - æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ã€APIå¯†é’¥ç­‰

### âŒ DON'Tï¼ˆé¿å…çš„åšæ³•ï¼‰

1. **ä¸è¦åæ‰å¼‚å¸¸**
   ```typescript
   // âŒ é”™è¯¯
   try {
     await operation();
   } catch (e) {
     // ä»€ä¹ˆéƒ½ä¸åš
   }

   // âœ… æ­£ç¡®
   try {
     await operation();
   } catch (e) {
     ErrorHandler.showError(e);
   }
   ```

2. **ä¸è¦ä½¿ç”¨ alert() æ˜¾ç¤ºé”™è¯¯**
   - ä½¿ç”¨ Toast æˆ–æ¨¡æ€å¯¹è¯æ¡†

3. **ä¸è¦è®©åº”ç”¨å´©æºƒ**
   - ä½¿ç”¨ ErrorBoundary æ•è·é”™è¯¯

4. **ä¸è¦å¿½ç•¥ç½‘ç»œé”™è¯¯**
   - æä¾›ç¦»çº¿æç¤ºå’Œé‡è¯•é€‰é¡¹

5. **ä¸è¦è¿‡åº¦ä½¿ç”¨å¼¹çª—**
   - éå…³é”®ä¿¡æ¯ä½¿ç”¨ Toast

### ğŸ¯ é”™è¯¯å¤„ç†æ£€æŸ¥æ¸…å•

åœ¨å®ç°æ–°åŠŸèƒ½æ—¶ï¼Œè¯·æ£€æŸ¥ï¼š

- [ ] API è°ƒç”¨æœ‰é”™è¯¯å¤„ç†
- [ ] å¼‚æ­¥æ“ä½œæœ‰ loading çŠ¶æ€
- [ ] è¡¨å•æœ‰éªŒè¯é”™è¯¯æç¤º
- [ ] å±é™©æ“ä½œæœ‰ç¡®è®¤å¯¹è¯æ¡†
- [ ] é”™è¯¯æœ‰å‹å¥½çš„æç¤ºä¿¡æ¯
- [ ] é”™è¯¯è¢«è®°å½•åˆ°æ—¥å¿—
- [ ] å…³é”®é”™è¯¯æœ‰ç›‘æ§ä¸ŠæŠ¥
- [ ] ç½‘ç»œé”™è¯¯æœ‰é‡è¯•æœºåˆ¶
- [ ] å¤±è´¥æ“ä½œå¯ä»¥é‡è¯•
- [ ] æ•æ„Ÿä¿¡æ¯å·²è„±æ•

---

## ç¤ºä¾‹ï¼šå®Œæ•´çš„åŠŸèƒ½å®ç°

```typescript
// ç¤ºä¾‹ï¼šåŒæ­¥ GitHub ä»“åº“
export function SyncRepositoriesButton() {
  const [loading, setLoading] = useState(false);
  const [progress, setProgress] = useState({ current: 0, total: 0 });
  const [showProgress, setShowProgress] = useState(false);

  const handleSync = async () => {
    // 1. ç¡®è®¤æ“ä½œ
    const confirmed = await confirm({
      title: 'åŒæ­¥ä»“åº“',
      description: 'è¿™å°†ä» GitHub åŒæ­¥æ‚¨çš„æ‰€æœ‰æ˜Ÿæ ‡ä»“åº“ï¼Œå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿæ—¶é—´ã€‚ç¡®å®šç»§ç»­å—ï¼Ÿ',
    });

    if (!confirmed) return;

    setLoading(true);
    setShowProgress(true);

    try {
      // 2. æ‰§è¡ŒåŒæ­¥ï¼Œå¸¦è¿›åº¦åé¦ˆ
      const token = localStorage.getItem('github_token');
      if (!token) {
        throw new AuthenticationError('è¯·å…ˆç™»å½•');
      }

      const githubApi = new GitHubAPI({ token });

      // è·å–æ‰€æœ‰ä»“åº“
      const repos = await githubApi.getAllStarredRepos((current) => {
        setProgress({ current, total: current });
      });

      setProgress({ current: 0, total: repos.length });

      // ä¿å­˜åˆ°æ•°æ®åº“
      for (let i = 0; i < repos.length; i++) {
        await repositoryAPI.create(transformGitHubRepo(repos[i]));
        setProgress({ current: i + 1, total: repos.length });
      }

      // 3. æˆåŠŸåé¦ˆ
      toast({
        title: 'åŒæ­¥æˆåŠŸ',
        description: `å·²åŒæ­¥ ${repos.length} ä¸ªä»“åº“`,
      });
    } catch (error) {
      // 4. é”™è¯¯å¤„ç†
      if (error instanceof RateLimitError) {
        toast({
          title: 'API é€Ÿç‡é™åˆ¶',
          description: `è¯·åœ¨ ${error.retryAfter} ç§’åé‡è¯•`,
          variant: 'destructive',
        });
      } else {
        ErrorHandler.showError(error, 'åŒæ­¥å¤±è´¥');
      }

      // 5. è®°å½•æ—¥å¿—
      logger.error('Repository sync failed', { error });
    } finally {
      setLoading(false);
      setTimeout(() => setShowProgress(false), 1000);
    }
  };

  return (
    <>
      <button
        onClick={handleSync}
        disabled={loading}
        className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50"
      >
        {loading ? (
          <>
            <LoadingSpinner size="sm" />
            <span>åŒæ­¥ä¸­...</span>
          </>
        ) : (
          'åŒæ­¥ä»“åº“'
        )}
      </button>

      {showProgress && (
        <ProgressBar
          current={progress.current}
          total={progress.total}
          label="æ­£åœ¨åŒæ­¥ä»“åº“"
        />
      )}
    </>
  );
}
```

---

## æ€»ç»“

è‰¯å¥½çš„é”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆæœºåˆ¶æ˜¯æå‡ç”¨æˆ·ä½“éªŒçš„å…³é”®ã€‚è¯·éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š

1. **é¢„é˜²ä¸ºä¸»**ï¼šé€šè¿‡éªŒè¯å’Œæ£€æŸ¥é¿å…é”™è¯¯å‘ç”Ÿ
2. **ä¼˜é›…é™çº§**ï¼šé”™è¯¯å‘ç”Ÿæ—¶åº”ç”¨ä»èƒ½éƒ¨åˆ†å¯ç”¨
3. **åŠæ—¶åé¦ˆ**ï¼šè®©ç”¨æˆ·çŸ¥é“å‘ç”Ÿäº†ä»€ä¹ˆ
4. **æä¾›è§£å†³æ–¹æ¡ˆ**ï¼šå‘Šè¯‰ç”¨æˆ·å¦‚ä½•è§£å†³é—®é¢˜
5. **è®°å½•å’Œç›‘æ§**ï¼šå¸®åŠ©å¼€å‘è€…å¿«é€Ÿå®šä½å’Œä¿®å¤é—®é¢˜

é€šè¿‡ç»Ÿä¸€çš„é”™è¯¯å¤„ç†ä½“ç³»ï¼Œæˆ‘ä»¬å¯ä»¥ï¼š
- æå‡ç”¨æˆ·ä½“éªŒå’Œæ»¡æ„åº¦
- å‡å°‘å®¢æˆ·æ”¯æŒæˆæœ¬
- å¿«é€Ÿå®šä½å’Œä¿®å¤é—®é¢˜
- æé«˜åº”ç”¨çš„ç¨³å®šæ€§å’Œå¯é æ€§

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼š1.0  
**æœ€åæ›´æ–°**ï¼š2025-10-31  
**ç»´æŠ¤è€…**ï¼šGitHub Stars Manager Team
